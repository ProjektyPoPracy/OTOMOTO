rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
labels
values
length(labels)==length(values)
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@id='offer-features__row']/ul/li/span") %>%
rvest::html_text()
equipment
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@id='offer-features__row']/ul/li/span")
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='offer-features__row']/ul/li/span")
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='offer-features__row']/ul/li")
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-features__row']/ul[@class='']/li[@class='']")
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-features__row']/ul[@class='offer-features__list']/li[@class='offer-features__item']") %>%
rvest::html_text()
equipment
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-features__row']/ul[@class='offer-features__list']/li[@class='offer-features__item']") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
equipment
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@data-text='Pokaż pełny opis']")
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div")
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text()
description
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text()
x <-
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
x
description
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value'][2]") %>%
rvest::html_text()
labels <- parameters.table %>%
rvest::html_nodes(xpath = "//ul/li/span[@class='offer-params__label']") %>%
rvest::html_text() %>%
gsub(pattern = " ", replacement = ".", x = .)
offer.id
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value'][1]") %>%
rvest::html_text()
offer.id
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item'][1]/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item'][2]/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
version
# platform       x86_64-pc-linux-gnu
# arch           x86_64
# os             linux-gnu
# system         x86_64, linux-gnu
# status
# major          3
# minor          4.4
# year           2018
# month          03
# day            15
# svn rev        74408
# language       R
# version.string R version 3.4.4 (2018-03-15)
# nickname       Someone to Lean On
options(stringsAsFactors = FALSE)
library(tidyverse)
library(xml2)
URL.core <- "https://www.otomoto.pl/osobowe/uzywane/"
URL.suffix <- "?page="
pageNumber <- 1
URL <- paste0(URL.core, URL.suffix, pageNumber)
offer.URLs <- xml2::read_html(URL) %>%
rvest::html_nodes(xpath = "//div/h2/a[@class='offer-title__link']") %>%
rvest::html_attr(name = "href")
offer.URL <- offer.URLs[20]
parameters.table <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@id='parameters']")
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
labels <- parameters.table %>%
rvest::html_nodes(xpath = "//ul/li/span[@class='offer-params__label']") %>%
rvest::html_text() %>%
gsub(pattern = " ", replacement = ".", x = .)
values <- parameters.table %>%
rvest::html_nodes(xpath = "//ul/li/div[@class='offer-params__value']") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
labels
values
length(labels)==length(values)
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-features__row']/ul[@class='offer-features__list']/li[@class='offer-features__item']") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
equipment
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
description
offer.URL
parameters.table
offer.id
labels
values
length(labels)==length(values)
one.offer <- data.frame(
Id = rep(offer.id, n),
Label = c(labels, equipment, "description"),
Value = c(values, rep(1, n_equipment), description)
)
## Połączenie informacji:
offer.id
length(labels)==length(values)
labels
values
equipment
description
n <- length(labels) + length(equipment) + 1
n_equipment <- length(equipment)
one.offer <- data.frame(
Id = rep(offer.id, n),
Label = c(labels, equipment, "description"),
Value = c(values, rep(1, n_equipment), description)
)
one.offer
View(one.offer)
offer.id
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Label = c(labels, equipment, "description"),
Value = c(values, rep(1, n_equipment), description)
)
one.offer
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Label = c(labels, equipment, "Opis"),
Value = c(values, rep(1, n_equipment), description)
)
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Date = rep(offer.id[1], n),
Label = c(labels, equipment, "Opis"),
Value = c(values, rep(1, n_equipment), description)
)
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Label = c(labels, equipment, "Opis", "Data.oferty"),
Value = c(values, rep(1, n_equipment), description, offer.id[1])
)
ffer.id[1]
offer.id[1]
n <- length(labels) + length(equipment) + 2
n_equipment <- length(equipment)
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Label = c(labels, equipment, "Opis", "Data.oferty"),
Value = c(values, rep(1, n_equipment), description, offer.id[1])
)
one.offer
offer.URL <- "https://www.otomoto.pl/oferta/mercedes-benz-w124-1984-1993-coupe-300ce-ID6AmpFl.html#3471ec01f4"
parameters.table <- xml2::read_html(offer.URL) %>%
rvest::html_node(xpath = "//div[@id='parameters']")
offer.id <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value']") %>%
rvest::html_text()
offer.id
labels <- parameters.table %>%
rvest::html_nodes(xpath = "//ul/li/span[@class='offer-params__label']") %>%
rvest::html_text() %>%
gsub(pattern = " ", replacement = ".", x = .)
values <- parameters.table %>%
rvest::html_nodes(xpath = "//ul/li/div[@class='offer-params__value']") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
labels
values
length(labels)==length(values)
equipment <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@class='offer-features__row']/ul[@class='offer-features__list']/li[@class='offer-features__item']") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
equipment
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
description
## Połączenie informacji:
offer.id
length(labels)==length(values)
labels
values
equipment
description
n <- length(labels) + length(equipment) + 2
n_equipment <- length(equipment)
one.offer <- data.frame(
Id = rep(offer.id[2], n),
Label = c(labels, equipment, "Opis", "Data.oferty"),
Value = c(values, rep(1, n_equipment), description, offer.id[1])
)
one.offer
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text()
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\n", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text()
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\\"", replacement = "", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\\"", replacement = "", x = .) %>%
gsub(pattern = "^\\s{2,}", replacement = " ", x = .) %>%
gsub(pattern = "\\s{2,}$", replacement = " ", x = .) %>%
gsub(pattern = "\\s{2,}", replacement = " ", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\\"", replacement = "", x = .) %>%
gsub(pattern = "^\\s{2,}", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}$", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}", replacement = " ", x = .)
description
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\\"", replacement = "'", x = .) %>%
gsub(pattern = "^\\s{2,}", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}$", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}", replacement = " ", x = .)
description
offer.URL <- offer.URLs[20]
description <- xml2::read_html(offer.URL) %>%
rvest::html_nodes(xpath = "//div[@id='description']/div") %>%
rvest::html_text() %>%
gsub(pattern = "\\n", replacement = "", x = .) %>%
gsub(pattern = "\\r", replacement = "", x = .) %>%
gsub(pattern = "\\\"", replacement = "'", x = .) %>%
gsub(pattern = "^\\s{2,}", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}$", replacement = "", x = .) %>%
gsub(pattern = "\\s{2,}", replacement = " ", x = .)
description
loadPackages <- function(pckgs)
{
for(pckg in pckgs)
{
if(!require(pckgs, character.only = TRUE))
{
install.packages(pckg)
}
library(pckg, character.only = TRUE)
}
invisible()
}
options(stringsAsFactors = FALSE)
library(tidyverse)
library(xml2)
URL.core <- "https://www.otomoto.pl/osobowe/uzywane/"
URL.suffix <- "?page="
pageNumber <- 1
URL <- paste0(URL.core, URL.suffix, pageNumber)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/ul[@class='om-pager rel']/li")
return(pageNumbers)
}
x <- getNumberOfPages(URL = URL)
install.packages(pckg)
loadPackages <- function(pckgs)
{
for(pckg in pckgs)
{
if(!require(pckg, character.only = TRUE))
{
install.packages(pckg)
}
library(pckg, character.only = TRUE)
}
invisible()
}
x <- getNumberOfPages(URL = URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
return(pageNumbers)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li") %>%
extract(., length(.))
return(pageNumbers)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
lastPageNumber <- pageNumbers[length(pageNumbers)-1] ## -1 ponieważ ostatnim elemntem jest strzałka za pomocą której przechodzi się do następnej strony
return(pageNumbers)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbers <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
lastPageNumber <- pageNumbers[length(pageNumbers)-1] ## -1 ponieważ ostatnim elemntem jest strzałka za pomocą której przechodzi się do następnej strony
return(lastPageNumber)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbersElements <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
lastPageNumberElement <- pageNumbersElements[length(pageNumbersElements)-1] ## -1 ponieważ ostatnim elemntem jest strzałka za pomocą której przechodzi się do następnej strony
lastPageNumber <- rvest::html_text(lastPageNumberElement)
return(lastPageNumber)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbersElements <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
lastPageNumberElement <- pageNumbersElements[length(pageNumbersElements)-1] ## -1 ponieważ ostatnim elemntem jest strzałka za pomocą której przechodzi się do następnej strony
lastPageNumber <- rvest::html_text(lastPageNumberElement) %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .)
return(lastPageNumber)
}
x <- getNumberOfPages(URL = URL)
getNumberOfPages <- function(URL)
{
options(stringsAsFactors = FALSE)
loadPackages(pckgs = c("rvest", "xml2"))
homePage <- xml2::read_html(URL)
pageNumbersElements <- homePage %>%
rvest::html_nodes(xpath = "//section[@id='body-container']/div[@class='container-fluid container-fluid-sm']/div[@class='row']/ul[@class='om-pager rel']/li")
lastPageNumberElement <- pageNumbersElements[length(pageNumbersElements)-1] ## -1 ponieważ ostatnim elemntem jest strzałka za pomocą której przechodzi się do następnej strony
lastPageNumber <- rvest::html_text(lastPageNumberElement) %>%
gsub(pattern = "\\s{2,}", replacement = "", x = .) %>%
as.numeric()
return(lastPageNumber)
}
x <- getNumberOfPages(URL = URL)
getOfferPrice <- function(page)
{
offerPriceNumber <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']") %>%
rvest::html_text()
offerPriceCurrency <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']span[@class='offer-price__currency']") %>%
rvest::html_text()
offerPriceDetails <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']span[@class='offer-price__details']") %>%
rvest::html_text()
offerPriceAll <- c(Value = offerPriceNumber, Currency = offerPriceCurrency, Details = offerPriceDetails)
return(offerPriceAll)
}
p <- xml2::read_html("https://www.otomoto.pl/oferta/volvo-v40-cc-bezwypadkowy-serwisowany-ID6Ayy8O.html#3471ec01f4")
x <- getOfferPrice(p)
getOfferPrice <- function(page)
{
offerPriceNumber <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']") %>%
rvest::html_text()
offerPriceCurrency <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']/span[@class='offer-price__currency']") %>%
rvest::html_text()
offerPriceDetails <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__details']") %>%
rvest::html_text()
offerPriceAll <- c(Value = offerPriceNumber, Currency = offerPriceCurrency, Details = offerPriceDetails)
return(offerPriceAll)
}
x <- getOfferPrice(p)
getOfferPrice <- function(page)
{
offerPriceNumber <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']") %>%
rvest::html_text() %>%
gsub(pattern = "[^0-9.]", replacement = "", x = .)
offerPriceCurrency <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']/span[@class='offer-price__currency']") %>%
rvest::html_text()
offerPriceDetails <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__details']") %>%
rvest::html_text()
offerPriceAll <- c(Value = offerPriceNumber, Currency = offerPriceCurrency, Details = offerPriceDetails)
return(offerPriceAll)
}
x <- getOfferPrice(p)
getOfferPrice <- function(page)
{
offerPriceNumber <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']") %>%
rvest::html_text() %>%
gsub(pattern = "[^0-9.]", replacement = "", x = .)
offerPriceCurrency <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__number']/span[@class='offer-price__currency']") %>%
rvest::html_text()
offerPriceDetails <- page %>%
rvest::html_node(xpath = "//section[@class='offer-header']/div[@class='offer-header__row']/div[@class='offer-price']/span[@class='offer-price__details']") %>%
rvest::html_text() %>%
strsplit(split = ", ") %>%
unlist() %>%
unname()
offerPriceAll <- c(Value = offerPriceNumber, Currency = offerPriceCurrency, Details = offerPriceDetails)
return(offerPriceAll)
}
x <- getOfferPrice(p)
p <- xml2::read_html("https://www.otomoto.pl/oferta/ford-fusion-swiezo-sprowadzony-i-wlasciciel-bezwypadkowy-po-oplatach-ID6Aw7E3.html#3471ec01f4")
x <- getOfferPrice(p)
x
