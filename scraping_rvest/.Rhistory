}
p <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
getNumberOfPhotos(p)
library(tidyverse)
getNumberOfPhotos(p)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']"
lisWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
return(lisWithPhotos)
}
getNumberOfPhotos(p)
getOfferId <- function(page, timeout)
{
options(timeout = timeout)
offerId <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-content__metabar']/div[@class='offer-meta']/span[@class='offer-meta__item']/span[@class='offer-meta__value']") %>%
rvest::html_text()
offerId[1] <- transformOfferDate(offerDate = offerId[1])
return(offerId)
}
getOfferId(p, 10)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "div[@id='siteWrap']/main[@class='page-offer']"
lisWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
return(lisWithPhotos)
}
p <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
getNumberOfPhotos(p)
p <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
getNumberOfPhotos(p)
getOfferId(p, 10)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "div[@id='siteWrap']/main[@class='page-offer']"
lisWithPhotos <- page %>%
xml2::read_html() %>%
rvest::html_nodes(xpath = xp)
return(lisWithPhotos)
}
getNumberOfPhotos(p)
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
# url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "//div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li"
lisWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
return(lisWithPhotos)
}
getOfferId(p, 10)
x <- getNumberOfPhotos(p)
x
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "///div[@class='offer-photos-thumbs']/li"
rm(xp)
lisWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
source('~/Documents/projects/otomoto/scraping_rvest/functions/codes/getNumberOfPhotos.R', echo=TRUE)
x <- getNumberOfPhotos(p)
x
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
x <- getNumberOfPhotos(p)
x
## 3
# url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
length(x)
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
x <- getNumberOfPhotos(p)
## 3
# url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
length(x)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
lastLi <- liWithPhotos[4]
txt <- lastLi %>%
rvest::html_text()
return(txt)
}
return(noOfPhotos)
}
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
x <- getNumberOfPhotos(p)
x
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
x <- getNumberOfPhotos(p)
x
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 3
url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = xp)
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
lastLi <- liWithPhotos[[4]]
txt <- lastLi %>%
rvest::html_text()
return(txt)
}
return(noOfPhotos)
}
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
return(hiddenPhotos)
}
return(noOfPhotos)
}
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 4
url <- "https://www.otomoto.pl/oferta/bmw-seria-5-instalacja-gazowa-520-ID6AGLZC.html#59dc0b20ed"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
length(x)
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
if(identical(hiddenPhotos, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "^\\d+", replacement = "", x = hiddenPhotosText)
return(hiddenPhotosNumber)
}
}
return(noOfPhotos)
}
## 4
url <- "https://www.otomoto.pl/oferta/bmw-seria-5-instalacja-gazowa-520-ID6AGLZC.html#59dc0b20ed"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
if(identical(hiddenPhotosText, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "^\\d+", replacement = "", x = hiddenPhotosText)
return(hiddenPhotosNumber)
}
}
return(noOfPhotos)
}
x <- getNumberOfPhotos(p)
x
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
if(identical(hiddenPhotosText, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "[^0-9]", replacement = "", x = hiddenPhotosText)
return(hiddenPhotosNumber)
}
}
return(noOfPhotos)
}
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
if(identical(hiddenPhotosText, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "[^0-9]", replacement = "", x = hiddenPhotosText)
noOfPhotos <- as.numeric(hiddenPhotosNumber) + 3
}
}
return(noOfPhotos)
}
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 7
url <- "https://www.otomoto.pl/oferta/opel-astra-ID6BlrPT.html#5c53a7b29e"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
length(x)
## 9
url <- "https://www.otomoto.pl/oferta/skoda-octavia-skoda-octavia-ii-bezwypadkowa-super-stan-okazja-ID6Bp2R9.html#2bd424144f"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 9
url <- "https://www.otomoto.pl/oferta/skoda-octavia-skoda-octavia-ii-bezwypadkowa-super-stan-okazja-ID6Bp2R9.html#2bd424144f"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
getNumberOfPhotos <- function(page)
{
# //div[@id='siteWrap']/main[@class='page-offer']/div[@class='offer-content offer-content--primary']/div[@class='offer-content__row']/div[@class='offer-content__gallery']/div[@class='offer-photos  ']/div[@class='offer-photos-thumbs']/li
# xp <- "///div[@class='offer-photos-thumbs']/li"
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
if(numberOfLi < 4)
{
noOfPhotos <- numberOfLi
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
if(identical(hiddenPhotosText, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "[^0-9]", replacement = "", x = hiddenPhotosText)
print(hiddenPhotosNumber)
noOfPhotos <- as.numeric(hiddenPhotosNumber) + 3
}
}
return(noOfPhotos)
}
## 9
url <- "https://www.otomoto.pl/oferta/skoda-octavia-skoda-octavia-ii-bezwypadkowa-super-stan-okazja-ID6Bp2R9.html#2bd424144f"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 3
url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 4
url <- "https://www.otomoto.pl/oferta/bmw-seria-5-instalacja-gazowa-520-ID6AGLZC.html#59dc0b20ed"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 7
url <- "https://www.otomoto.pl/oferta/opel-astra-ID6BlrPT.html#5c53a7b29e"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 9
url <- "https://www.otomoto.pl/oferta/skoda-octavia-skoda-octavia-ii-bezwypadkowa-super-stan-okazja-ID6Bp2R9.html#2bd424144f"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
quantify4OrMorePhotos <- function(moreText)
{
if(identical(moreText, character(0)))
{
noOfPhotos <- 4
}
else
{
hiddenPhotosNumber <- gsub(pattern = "[^0-9]", replacement = "", x = moreText)
noOfPhotos <- as.numeric(hiddenPhotosNumber) + 3
}
return(noOfPhotos)
}
quantifyPhotos <- function(page, noOfAtributes)
{
if(noOfAtributes < 4)
{
noOfPhotos <- noOfAtributes
}
else
{
hiddenPhotosText <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/a[@class='offer-photos-thumbs__link-more']") %>%
rvest::html_text()
noOfPhotos <- quantify4OrMorePhotos(moreText = hiddenPhotosText)
}
return(noOfPhotos)
}
getNumberOfPhotos <- function(page)
{
liWithPhotos <- page %>%
rvest::html_nodes(xpath = "//div[@class='offer-photos-thumbs']/li")
numberOfLi <- length(liWithPhotos)
noOfPhotos <- quantifyPhotos(page = page, noOfAtributes = numberOfLi)
return(noOfPhotos)
}
## 38
url <- "https://www.otomoto.pl/oferta/volvo-v40-2-0-d4-panorama-alu-navi-wersja-summum-pakiet-polestar-230-km-ID6BhPMv.html#88ce5505f9"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 0
url <- "https://www.otomoto.pl/oferta/opel-corsa-1-2-benzyna-niemcy-klima-ID6Bb6Tg.html#1eb9ef4cce"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 3
url <- "https://www.otomoto.pl/oferta/fiat-punto-5-drzwi-punto-do-jazdy-ID6AGbJ4.html#c47d2d9d43"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 4
url <- "https://www.otomoto.pl/oferta/bmw-seria-5-instalacja-gazowa-520-ID6AGLZC.html#59dc0b20ed"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 7
url <- "https://www.otomoto.pl/oferta/opel-astra-ID6BlrPT.html#5c53a7b29e"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
## 9
url <- "https://www.otomoto.pl/oferta/skoda-octavia-skoda-octavia-ii-bezwypadkowa-super-stan-okazja-ID6Bp2R9.html#2bd424144f"
p <- xml2::read_html(url)
x <- getNumberOfPhotos(p)
x
funList <- list.files("./functions/codes/")
for(f in funList)
{
source(file = paste0("./functions/codes/", f))
}; rm(f, funList)
getOffersInfo_avoidErr(
offer.type = "u", ## Possible values: "a" - all; "n" - new; "u" - used
startPageNr = 1, ## Page number to start; default 1
stopPageNr = 3, ## Page number to stop; default 10; if NULL then running function to last page
init.df = NULL, ## "offers" ## Declare data frame name you have if you want add info about new offers to it
output.name = "offers", ## An output data frame name. Function create date frame with that name; default "offers"
sleep = 5, ## Forced break between scraping next offer pages; default 10; do not overload the website with your activity
timeout = 4000000, ## Time required to interrupt the connection. Too low value should cause errors.
n_iter = 5 ## How many times the function has to be restarted untill will be terminated
)
View(offers)
funList <- list.files("./functions/codes/")
for(f in funList)
{
source(file = paste0("./functions/codes/", f))
}; rm(f, funList)
getOffersInfo_avoidErr(
offer.type = "u", ## Possible values: "a" - all; "n" - new; "u" - used
startPageNr = 1, ## Page number to start; default 1
stopPageNr = 3, ## Page number to stop; default 10; if NULL then running function to last page
init.df = "offers", ## "offers" ## Declare input data frame name you have if you want to add row to it
output.name = "offers", ## An output data frame name. Function create date frame with that name; default "offers"
sleep = 5, ## Forced break between scraping next offer pages; default 10; do not overload the website with your activity
timeout = 4000000, ## Time required to interrupt the connection. Too low value should cause errors. Not working :(
n_iter = 5 ## How many times the function has to be restarted untill will be terminated
)
getOffersInfo_avoidErr(
offer.type = "u", ## Possible values: "a" - all; "n" - new; "u" - used
startPageNr = 4, ## Page number to start; default 1
stopPageNr = 5, ## Page number to stop; default 10; if NULL then running function to last page
init.df = "offers", ## "offers" ## Declare input data frame name you have if you want to add row to it
output.name = "offers", ## An output data frame name. Function create date frame with that name; default "offers"
sleep = 5, ## Forced break between scraping next offer pages; default 10; do not overload the website with your activity
timeout = 4000000, ## Time required to interrupt the connection. Too low value should cause errors. Not working :(
n_iter = 5 ## How many times the function has to be restarted untill will be terminated
)
nrow(offers)
length(unique(offers$Id))
